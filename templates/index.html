{% extends "base.html" %}

{% block title %}æ¨¡æ“¬åº—ä¼šè¨ˆApp{% endblock %}

{% block content %}
    <h1>å£²ä¸Šè¨ˆç®—</h1>

    <!-- {% if message %}
        <div class="alert alert-warning">{{ message }}</div>
    {% endif %} -->

    {% if items %}
    <form method="POST" action="{{ url_for('index') }}" class="mb-3" style="margin-bottom: 20px;"> <!-- ä¸‹ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  -->

        <!-- ğŸ”½ ã‚·ãƒ•ãƒˆç•ªå·å…¥åŠ›æ¬„ã®è¿½åŠ  -->
        <div class="form-group col-md-3 mb-3">
            <label for="shift_number">ã‚·ãƒ•ãƒˆç•ªå·</label>
            <input type="number" name="shift_number" min="1" value="1" class="form-control text-center" id="shift_number" style="max-width: 100px;">
        </div>

        <div class="form-row">
            {% for item in items %}
                <div class="form-group col-md-3 mb-2">
                    <label for="item_{{ item.id }}">{{ item.name }} (Â¥{{ item.price }})</label>
                    <div class="input-group">
                        <input type="number" name="quantities[{{ item.id }}]" min="0" value="0"
                            class="form-control text-center" id="item_{{ item.id }}" onchange="validateQuantity({{ item.id }})" style="max-width: 80px;">
                        <div class="input-group-append" style="margin-left: 5px;">
                            <button type="button" class="btn btn-secondary" onclick="changeQuantity({{ item.id }}, -1)">ãƒ¼</button>
                            <button type="button" class="btn btn-secondary" onclick="changeQuantity({{ item.id }}, 1)">+</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary" style="margin-top: 20px;">åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—</button>
    </form>

    {% else %}
        <div class="alert alert-info">
            ã€Œå•†å“ä¸€è¦§ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰å•†å“ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ >> 
            <a href="{{ url_for('items') }}" class="alert-link">å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸</a>
        </div>
    {% endif %}

    <br> <!-- ãƒ•ã‚©ãƒ¼ãƒ ã®é–“ã«éš™é–“ã‚’ä½œã‚‹ãŸã‚ã®æ”¹è¡Œ -->
    
    {% if total > 0 %}
        <h4>è³¼å…¥ã•ã‚ŒãŸå•†å“</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>å•†å“å</th>
                    <th>å˜ä¾¡</th>
                    <th>æ•°é‡</th>
                    <th>åˆè¨ˆé‡‘é¡</th>
                </tr>
            </thead>
            <tbody>
                {% for record in sales_records %}
                <tr>
                    <td>{{ record.item_name }}</td>
                    <td>Â¥{{ record.price }}</td>
                    <td>{{ record.quantity }}</td>
                    <td>Â¥{{ record.total }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h2 class="mt-4">åˆè¨ˆé‡‘é¡: Â¥{{ total }}</h2>
    {% endif %}
    
    <script>
        function changeQuantity(itemId, delta) {
            const input = document.getElementById(`item_${itemId}`);
            let currentQuantity = parseInt(input.value) || 0;
            currentQuantity += delta;

            // æœ€å°å€¤ã¯0ã«åˆ¶é™
            if (currentQuantity < 0) {
                currentQuantity = 0;
            }

            input.value = currentQuantity;
        }

        function validateQuantity(itemId) {
            const input = document.getElementById(`item_${itemId}`);
            let currentQuantity = parseInt(input.value) || 0;

            // è² ã®å€¤ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã¯0ã«ãƒªã‚»ãƒƒãƒˆ
            if (currentQuantity < 0) {
                input.value = 0;
            }
        }
    </script>
{% endblock %}
